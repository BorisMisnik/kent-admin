(function(c){var e=c.Callbacks("once unique memory"),b=0,d=null;if(window.FileReader){c.fn.fileReader=function(){return this;};return;}c.fn.fileReader=function(g){g=c.extend(c.fn.fileReader.defaults,g);var f=this;e.add(function(){return a(f,g);});if(c.isFunction(g.callback)){e.add(g.callback);}if(!FileAPIProxy.ready){FileAPIProxy.init(g);}return this;};c.fn.fileReader.defaults={id:"fileReaderSWFObject",multiple:null,accept:null,label:null,extensions:null,filereader:"files/filereader.swf",expressInstall:null,debugMode:false,callback:false};var a=function(g,f){return g.each(function(j,h){h=c(h);var k=h.attr("id");if(!k){k="flashFileInput"+b;h.attr("id",k);b++;}f.multiple=!!(f.multiple===null?h.attr("multiple"):f.multiple);f.accept=f.accept===null?h.attr("accept"):f.accept;FileAPIProxy.inputs[k]=h;FileAPIProxy.swfObject.add(k,f.multiple,f.accept,f.label,f.extensions);h.css("z-index",0).mouseover(function(i){if(k!==d){i=i||window.event;d=k;FileAPIProxy.swfObject.mouseover(k);FileAPIProxy.container.height(h.outerHeight()).width(h.outerWidth()).css(h.offset());}}).click(function(i){i.preventDefault();i.stopPropagation();i.stopImmediatePropagation();return false;});});};window.FileAPIProxy={ready:false,init:function(g){var f=this;this.debugMode=g.debugMode;this.container=c("<div>").attr("id",g.id).wrap("<div>").parent().css({position:"fixed",width:"1px",height:"1px",display:"inline-block",background:"transparent","z-index":99999}).on("mouseover mouseout mousedown mouseup",function(h){if(d){c("#"+d).trigger(h.type);}}).appendTo("body");swfobject.embedSWF(g.filereader,g.id,"100%","100%","10",g.expressInstall,{debugMode:g.debugMode?true:""},{wmode:"transparent",allowScriptAccess:"sameDomain"},{},function(h){f.swfObject=h.ref;c(f.swfObject).css({display:"block",outline:0}).attr("tabindex",0);if(f.ready){e.fire();}f.ready=h.success&&typeof h.ref.add==="function";});},swfObject:null,container:null,inputs:{},readers:{},onFileInputEvent:function(f){if(this.debugMode){console.info("FileInput Event ",f.type,f);}if(f.target in this.inputs){var g=this.inputs[f.target];f.target=g[0];if(f.type==="change"){f.files=new FileList(f.files);f.target={files:f.files};}g.trigger(f);}window.focus();},onFileReaderEvent:function(g){if(this.debugMode){console.info("FileReader Event ",g.type,g,g.target in this.readers);}if(g.target in this.readers){var f=this.readers[g.target];g.target=f;f._handleFlashEvent.call(f,g);}},onFileReaderError:function(f){if(this.debugMode){console.log(f);}},onSWFReady:function(){this.container.css({position:"absolute"});this.ready=typeof this.swfObject.add==="function";if(this.ready){e.fire();}return true;}};window.FileReader=function(){this.EMPTY=0;this.LOADING=1;this.DONE=2;this.readyState=0;this.result=null;this.error=null;this.onloadstart=null;this.onprogress=null;this.onload=null;this.onabort=null;this.onerror=null;this.onloadend=null;this._callbacks={loadstart:c.Callbacks("unique"),progress:c.Callbacks("unique"),abort:c.Callbacks("unique"),error:c.Callbacks("unique"),load:c.Callbacks("unique"),loadend:c.Callbacks("unique")};this._id=null;};window.FileReader.prototype={readAsBinaryString:function(f){this._start(f);FileAPIProxy.swfObject.read(f.input,f.name,"readAsBinaryString");},readAsText:function(f,g){this._start(f);FileAPIProxy.swfObject.read(f.input,f.name,"readAsText");},readAsDataURL:function(f){this._start(f);FileAPIProxy.swfObject.read(f.input,f.name,"readAsDataURL");},readAsArrayBuffer:function(f){throw ("Whoops FileReader.readAsArrayBuffer is unimplemented");},abort:function(){this.result=null;if(this.readyState===this.EMPTY||this.readyState===this.DONE){return;}FileAPIProxy.swfObject.abort(this._id);},addEventListener:function(f,g){if(f in this._callbacks){this._callbacks[f].add(g);}},removeEventListener:function(f,g){if(f in this._callbacks){this._callbacks[f].remove(g);}},dispatchEvent:function(g){g.target=this;if(g.type in this._callbacks){var f=this["on"+g.type];if(c.isFunction(f)){f(g);}this._callbacks[g.type].fire(g);}return true;},_register:function(f){this._id=f.input+"."+f.name;FileAPIProxy.readers[this._id]=this;},_start:function(f){this._register(f);if(this.readyState===this.LOADING){throw {type:"InvalidStateError",code:11,message:"The object is in an invalid state."};}},_handleFlashEvent:function(f){switch(f.type){case"loadstart":this.readyState=this.LOADING;break;case"loadend":this.readyState=this.DONE;break;case"load":this.readyState=this.DONE;this.result=FileAPIProxy.swfObject.result(this._id);break;case"error":this.result=null;this.error={name:"NotReadableError",message:"The File cannot be read!"};}this.dispatchEvent(new FileReaderEvent(f));}};FileReaderEvent=function(f){this.initEvent(f);};FileReaderEvent.prototype={initEvent:function(f){c.extend(this,{type:null,target:null,currentTarget:null,eventPhase:2,bubbles:false,cancelable:false,defaultPrevented:false,isTrusted:false,timeStamp:new Date().getTime()},f);},stopPropagation:function(){},stopImmediatePropagation:function(){},preventDefault:function(){}};FileList=function(g){if(g){for(var f=0;f<g.length;f++){this[f]=g[f];}this.length=g.length;}else{this.length=0;}};FileList.prototype={item:function(f){if(f in this){return this[f];}return null;}};})(jQuery);