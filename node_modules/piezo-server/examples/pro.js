/*!
 * Module: Module
 *
 * @author Andjey Guzhovskiy, <me.the.ascii@gmail.com>
 * @copyright (c) 2013 Andjey Guzhovskiy
 * @licence CLOSED
 * @version 0.0.1
 */

var service = require( '../index' ),
    colors = require( 'colors' ),
    config = {

        // todo: main values
        defaults: {
            mongodb: {
                host: 'localhost',
                port: 27017,
                database: 'test1'
            }
        },

        // plugins
        http: {
            port: 8000,
            static: './public',
            routes: require( '../routes.json' )
        },
        mail: {
            // predefined
            service: 'Mailgun',
            proto: 'smtp',
            user: 'api',
            password: 'key-aaaaa',
            // fields
            from: {
                email: 'test@mail.com',
                title: 'Test Mailing'
            }
        },
        auth: {
            collection: 'accounts'
        },
        cards: {
            collection: 'cards'
        },
        lists: {
            host: 'localhost',
            port: 27017,
            database: 'test1',
            collection: 'lists'
        },
        log: {
            level: 'debug',
            mongodb: {
                collection: 'logs'
            },
            console:
                true,
            file: {
                level: 'info',
                path: './pro.log'
            }
        }
    };
    // require( 'pro.json' );

service
    // .use([ 'http', 'mail', 'auth', 'cards', 'lists', 'log' ])
    .configure( config )
    .init( function() {
        console.log( 'Main Application Started'.bold.cyan, '\n' );
        //console.log( service.libs );

        var http = service.libs.http,
            auth = service.libs.auth,
            trace = service.libs.log,
            cards = service.libs.cards;

        trace.warn( 'debug it', { payload: true });

        debugger;
//        cards.create(
//            {
//                test: Math.random().toString( 16 ).substr( 2 ),
//                account_id: 1,
//                type: 'feedback'
//            },
//            //{ exists: false },
//            function( err, doc ) {
//                console.log( 'card create:', arguments );
//            });
//
//        cards.get({ account_id: 1 }, function( err, doc ) {
//            console.log( 'card get:', arguments );
//        })
//
//        cards.update(
//            { account_id: 1 },
//            { agree: true },
//            function( err, updated ) {
//                console.log( 'card update:', arguments );
//            });
//
//        cards.remove(
//            { account_id: 1 },
//            function( err, count ) {
//                console.log( 'cards remove:', arguments );
//            });


    });